!function(a){"use strict";var b=a.onerror;a.onerror=function(a,c,d,e,f){if(c=c||"",-1!==c.indexOf("//www.bizcardmaker.com/")){if("function"==typeof ga){var g=a;void 0!==f&&void 0!==f.message&&(g=f.message),g+=" @ "+c+":"+d+":"+e,ga("send","exception",{exDescription:g})}return"function"==typeof b&&b(a,c,d,e,f)}}}(window),function(){"use strict";function a(a){var b=window.location.hash.substr(1),c=b.substr(b.indexOf(a+"=")).split("&")[0].split("=")[1];return c||null}function b(a,b){for(var c;a&&a!==document;){if(!a.parentNode)return null;if(c=a.parentNode.querySelectorAll(b),-1!==[].indexOf.call(c,a))return a;a=a.parentNode}return null}function c(a,b){if(!a.className)return!1;var c=" "+a.className+" ";return b=" "+b+" ",-1!==c.indexOf(b)}function d(a,b){return c(a,b)?a.className:(a.className&&(b=" "+b),a.className+=b,a.className)}function e(a,b){var c=" "+b,d=b+" ";return-1!==a.className.indexOf(c)?a.className=a.className.replace(c,""):-1!==a.className.indexOf(d)?a.className=a.className.replace(d,""):a.className=a.className.replace(b,""),a.className}window.util={closest:b,hash:a,hasClass:c,addClass:d,removeClass:e}}();var printchompUrl="http://sandbox.printchomp.com",apiUrl="http://localhost:8080",env="local";-1!==document.domain.indexOf("development.")&&(env="dev"),-1!==document.domain.indexOf("staging.")&&(env="stage"),-1!==document.domain.indexOf("www.")&&(env="live"),"dev"===env&&(apiUrl="https://dev-bizcardmaker.rhcloud.com"),"live"!==env&&"stage"!==env||(apiUrl="https://live-bizcardmaker.rhcloud.com",printchompUrl="https://printchomp.com"),function(){"use strict";$(document).on("opened","[data-reveal]",function(){$(document.body).addClass("modal-opened")}),$(document).on("closed","[data-reveal]",function(){$(document.body).removeClass("modal-opened")})}(),function(){"use strict";if("object"==typeof localStorage)try{localStorage.setItem("localStorage",1),localStorage.removeItem("localStorage")}catch(a){window.Storage.prototype._setItem=window.Storage.prototype.setItem,window.Storage.prototype.setItem=function(){}}var a=-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome"),b=document.querySelector(".warning-safari");a&&(b.className+="warning-safari-show")}(),function(){"use strict";var a=function(a){window.util.closest(a.target,".js-order-btn-psprint")&&ga("send","event","Orders","Clicked PsPrint button")};document.body.addEventListener("click",a)}(),function(){"use strict";var a=(document.querySelector(".js-order-btn-psprint"),function(a){window.util.closest(a.target,".js-order-btn-psprint")&&window.open("http://www.shareasale.com/r.cfm?b=283670&u=1215865&m=22819&urllink=&afftrack=","psprint")});document.body.addEventListener("click",a)}(),function(){"use strict";var a=document.querySelector(".js-modal-logaster");if(a){var b=function(b){window.util.closest(b.target,".js-btn-logaster")&&$(a).foundation("open")},c=function(b){b.target.classList.contains("js-close-modal")&&($(a).foundation("close"),b.preventDefault())};a.addEventListener("click",c),document.body.addEventListener("click",b)}}(),function(){"use strict";var a=document.querySelector("#modal-affiliate");if(a){var b=a.querySelector(".js-checkbox-affiliate-hide"),c=null,d=JSON.stringify({modalHide:!1,modalTime:Date.now()}),e=function(e){window.util.closest(e.target,".js-affiliate-modal")&&(null===c&&(c=window.localStorage.getItem("bizcardmaker-affiliate")||d,"object"!=typeof(c=JSON.parse(c))&&(c=JSON.parse(d))),!0===c.modalHide&&Date.now()-c.modalTime>864e5&&(c.modalHide=!1,b.checked=!1),!0!==c.modalHide&&($(a).foundation("open"),ga("send","event","Affiliate","View affiliate modal")))},f=function(b){b.target.classList.contains("js-close-modal")&&($(a).foundation("close"),b.preventDefault())},g=function(a){a.target.checked?(c.modalHide=!0,c.modalTime=Date.now()):c.modalHide=!1,window.localStorage.setItem("bizcardmaker-affiliate",JSON.stringify(c))};a.addEventListener("click",f),document.body.addEventListener("click",e),b.addEventListener("change",g)}}(),function(){"use strict";var a=function(a){if(window.util.closest(a.target,".js-newsletter-subscribe")){var b=document.querySelector(".card-content"),c=b.querySelector(".email p").textContent.trim(),d=new window.XMLHttpRequest;d.open("POST",apiUrl+"/newsletter/subscribe"),d.setRequestHeader("Content-Type","application/json;charset=UTF-8"),d.send(JSON.stringify({email:c}))}};document.body.addEventListener("click",a)}(),function(){"use strict";function a(){if(!(c=window.util.hash("theme")))return void d.querySelector(".theme-item").click();b=d.querySelector(".active"),b&&window.util.removeClass(b,"active"),(b=d.querySelector(".js-"+c))&&window.util.addClass(b,"active")}var b,c="",d=document.querySelector(".themes-box");d&&(a(),window.addEventListener("hashchange",a,!1))}(),window.GeneratePdf=function(){"use strict";var a={card:[3.75,2.25],margin:.35,trim:.125},b=a.card[0],c=a.card[1],d=a.trim,e=d+a.margin,f=a.margin-d,g=[{x:e,y:.06,x1:e,y1:e-.06},{x:.06,y:e,x1:e-.06,y1:e},{x:b+f,y:.06,x1:b+f,y1:e-.06},{x:b+f+.06,y:e,x1:b+2*a.margin-.06,y1:e},{x:e,y:c+f+.06,x1:e,y1:c+2*a.margin-.06},{x:.06,y:c+f,x1:e-.06,y1:c+f},{x:b+f,y:c+f+.06,x1:b+f,y1:c+2*a.margin-.06},{x:b+f+.06,y:c+f,x1:b+2*a.margin-.06,y1:c+f}];return function(d,e){var f=new jsPDF("landscape","in",[b+2*a.margin,c+2*a.margin]);f.addImage(e,"JPEG",a.margin,a.margin,b,c),g.forEach(function(a){f.setLineWidth(.01),f.line(a.x,a.y,a.x1,a.y1)}),f.save(d)}}();var app=angular.module("businessCardMaker",["ngRoute","angular-meditor"]);app.run(["$rootScope",function(a){"use strict";a.root={}}]),app.directive("fileread",[function(){"use strict";return{scope:{fileread:"="},link:function(a,b){b.bind("change",function(b){a.$apply(function(){a.fileread=b.target.files[0]})})}}}]),app.directive("drModel",["$document","$timeout",function(a,b){"use strict";return{template:'<div class="dr-container"><div class="drag-handle"></div><div class="resize-handle"></div><div ng-transclude></div></div>',scope:{drModel:"=",drContainer:"@",drGrid:"@"},replace:!0,transclude:!0,link:function(a,b){var c=document.getElementsByTagName("body")[0],d=c;a.drContainer&&(d=document.querySelector(a.drContainer));var e,f,g=b[0].querySelector(".drag-handle"),h=b[0].querySelector(".resize-handle"),i=["webkitTransform","msTransform","transform"],j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=!1,s=!1,t=a.drGrid,u=function(a){return Math.floor(a/t)*t},v=function(a){var b=g.getBoundingClientRect(),c=d.getBoundingClientRect(),e=b.top,f=b.left;p=e-c.top,p=0-u(p),q=c.top+c.height-e-b.height,q=u(q),n=f-c.left,n=0-u(n),o=c.left+c.width-f-b.width,o=u(o)},w=function(a){return a%t==0?a:a-a%t},x=function(a){if(r||s){if(a.preventDefault(),l=w(a.touches[0].pageX-j),m=w(a.touches[0].pageY-k),l>o&&(l=o),m>q&&(m=q),r){l<n&&(l=n),m<p&&(m=p);var c="translate3d("+l+"px ,"+m+"px, 0)";angular.forEach(i,function(a){b.css(a,c)})}if(s){var d=b._startHeight+m;b.css("height",d);var e=b._startWidth+l;b.css("width",e)}}},y=function(d){if(r||s){if(r){r=!1,angular.forEach(i,function(a){b.css(a,"")});var e=l,f=m;"absolute"===b.css("position")?(e+=b[0].offsetLeft,f+=b[0].offsetTop):(b.css("left")&&"auto"!==b.css("left")&&(e=parseInt(b.css("left"),10)+l),b.css("top")&&"auto"!==b.css("top")&&(f=parseInt(b.css("top"),10)+m)),b.css({top:f,left:e,bottom:"auto",right:"auto"}),a.drModel&&(a.drModel.x=e,a.drModel.y=f)}s&&(s=!1,a.drModel&&(a.drModel.width=parseInt(b.css("width")),a.drModel.height=parseInt(b.css("height")))),c.classList.remove("dr-active"),b[0].classList.remove("dr-handle-show")}},z=function(a){var d=a.target;v(),l=m=0,j=a.touches[0].pageX-l,k=a.touches[0].pageY-m,d===h?(s=!0,b._startHeight=parseInt(b.css("height")),b._startWidth=parseInt(b.css("width"))):r=!0,c.classList.add("dr-active"),b[0].classList.add("dr-handle-show")},A=function(a){if(!r)return e=c.scrollTop,void(f=c.scrollLeft);c.scrollTop=e,c.scrollLeft=f},B=function(a){return a.touches=[{clientX:a.clientX,clientY:a.clientY,pageX:a.pageX,pageY:a.pageY}],a},C=function(){a.drModel.x=a.drModel.x||"",b.css({left:a.drModel.x}),a.drModel.y=a.drModel.y||"",b.css({top:a.drModel.y}),a.drModel.width=a.drModel.width||"",b.css({width:a.drModel.width}),a.drModel.height=a.drModel.height||"",b.css({height:a.drModel.height})};a.$watch("drModel",C,!0),h.addEventListener("mousedown",function(a){z(B(a))}),h.addEventListener("touchstart",z),g.addEventListener("mousedown",function(a){z(B(a))}),g.addEventListener("touchstart",z),document.addEventListener("mousemove",function(a){x(B(a))}),document.addEventListener("touchmove",x),document.addEventListener("mouseup",y),document.addEventListener("touchend",y),window.addEventListener("scroll",A)}}}]),app.controller("MainCtrl",["$rootScope","$scope","$routeParams","$location","$timeout","$q",function(a,b,c,d,e,f){"use strict";var g,h=b.model={};h.cardPictureFile="",h.cardPicture="",h.imageData="",h.imageFilename="bizcardmaker-com",h.imageExt=".jpg",h.pdfData="",h.pdfFilename="bizcardmaker-com.pdf",h.loadingCard=!1;var i=new Date;i.setDate(i.getDate()+23),h.promoExpire=i,h.storeDefaults={card:{name:"John Doe",position:"Position",organization:"Organization",location:"City, State",phone:"(123) 555-1234",email:"john.doe@cmail.com",url:"www.john-doe.com"},position:{picture:{},person:{},details:{},email:{},url:{}}},h.store={card:{},position:{}},angular.copy(h.storeDefaults,h.store);var j=window.localStorage.getItem("bizcardmaker-store");j&&angular.extend(h.store,angular.fromJson(j));b.$watch("model.store",function(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}}(function(a){window.localStorage.setItem("bizcardmaker-store",angular.toJson(a))},500),!0);var k=function(){if(document.querySelector(".card-preview")){var a=document.querySelector(".card-preview").querySelectorAll("*");angular.forEach(a,function(a){a.removeAttribute("style")})}};b.ResetCard=function(a){if(k(),a)angular.copy(h.storeDefaults.position,h.store.position);else{var b=h.store.theme;angular.copy(h.storeDefaults,h.store),h.store.theme=b}window.localStorage.removeItem("bizcardmaker-store")},h.store.theme&&d.search("theme",h.store.theme),b.$on("$locationChangeStart",function(){var a=d.search().theme;a!==h.store.theme&&b.ResetCard(!0),h.store.theme=a}),b.$watch("model.cardPictureFile",function(){if(h.cardPictureFile){var a=/image.*/;if(h.cardPictureFile.type.match(a)){var b=new FileReader;b.onload=function(){e(function(){h.cardPicture=b.result})},b.readAsDataURL(h.cardPictureFile)}else window.alert("File not supported!")}});var l=function(a){var b=window.getComputedStyle(a.parentNode,null),c=window.getComputedStyle(a,null),d=parseFloat(c.fontSize),e=parseFloat(b.fontSize),f=["left","top","width","height"],g="",h={};f.forEach(function(b){if((g=a.style[b])&&-1===g.indexOf("em")){var f=parseFloat(c[b]),i=f/e,j=d/e;i+=(i-i*j)/j,h[b]=i+"em"}}),Object.keys(h).forEach(function(b){a.style[b]=h[b]}),"font"===a.tagName.toLowerCase()&&-1===c.fontSize.indexOf("em")&&(a.style.fontSize=d/e+"em")},m={1:"10",2:"13",3:"16",4:"18",5:"24",6:"32",7:"48"},n=function(a){var b,c=a.querySelectorAll("[contenteditable]");angular.forEach(c,function(a){b=a.querySelectorAll("*"),angular.forEach(b,function(a){"font"===a.tagName.toLowerCase()&&(a.style.fontSize=m[a.size]+"px"),l(a)})});var d=a.querySelectorAll(".card-item[style]"),e=a.querySelector(".card-picture[style]");angular.forEach(d,function(a){l(a)}),e&&l(e)};b.generatePicture=function(a){a=a||function(){};var b=f.defer();window.getSelection().removeAllRanges();var c=document.querySelector(".js-card-container").cloneNode(!0);return c.classList.add("card-invisible"),document.body.appendChild(c),n(c),c.classList.add("card-big"),h.loadingCard=!0,html2canvas(c,{letterRendering:!0}).then(function(d){document.body.removeChild(c),h.loadingCard=!1,b.resolve(d),a(d)}),b.promise},b.DownloadPdf=function(){b.generatePicture().then(function(a){var b=a.toDataURL("image/jpeg",1);window.GeneratePdf(h.pdfFilename,b)}),ga("send","event","Download","Download PDF",h.store.theme)},b.DownloadPicture=function(){b.generatePicture().then(function(a){a.toBlob(function(a){var b=h.imageFilename+"-"+h.store.theme+h.imageExt;saveAs(a,b),$(".card-container")[0].scrollIntoView(!0)},"image/jpeg")}),ga("send","event","Download","Download picture",h.store.theme)},h.openedModal=!1,h.order={},b.OpenOrderModal=function(){var a=document.querySelector(".card-content"),c=Math.ceil(a.scrollWidth),d=Math.ceil(a.scrollHeight),e=Math.ceil(a.clientWidth),f=Math.ceil(a.clientHeight),i=Math.abs(c-e)>5,j=Math.abs(d-f)>5;if(i||j)return window.alert("Oops! \nSome of the details on your card will be cut during the printing process. \n\nTo make sure this doesn't happen, please try: \n* Shortening some of text lines \n* Moving the elements closer to the card center \n"),ga("send","event","Orders","Overflow error"),!1;h.openedModal||(h.order.email=$(".email p",a).text().trim(),h.order.name=$(".fn",a).text().trim(),h.order.phone=$(".tel",a).text().trim(),h.order.city=$(".locality",a).text().trim(),h.openedModal=!0),b.generatePicture().then(function(a){g.foundation("open");var b=a.toDataURL("image/jpeg");h.imagePreview=b})};var o=0;b.$on("$includeContentLoaded",function(){if(1===++o){g=$(".modal-order"),$(document.querySelector(".card-editor")).foundation();var a=document.querySelector(".card-content");a&&a.addEventListener("scroll",function(b){a.scrollTop=0,a.scrollLeft=0})}})}]),angular.module("businessCardMaker").run(["$templateCache",function(a){"use strict";a.put("views/cardeditor.html",'<h2>\n  Customize your business card\n\n  <button type="button" class="button small muted btn-reset" ng-click="ResetCard()" title="Undo all the styling changes you made. The text and logo will stay the same.">\n    <i class="fa fa-undo"></i>\n    Reset changes\n  </button>\n</h2>\n\n<div class="card-container js-card-container" ng-class="{ \' state-loading\': model.loadingCard }">\n  <div class="card-preview {{ model.store.theme }}">\n\n    <div class="card-content">\n\n      <input type="file" id="picture-upload" class="file-upload" fileread="model.cardPictureFile">\n\n      <div class="card-picture" dr-container=".card-content" dr-model="model.store.position.picture" dr-grid="10">\n\n        <label for="picture-upload" ng-class="{ \'no-picture\': !model.cardPicture }" title="Click to upload your own logo">\n\n          <i class="fa fa-picture-o"></i>\n          <span>Upload your logo</span>\n\n          <img ng-src="{{ model.cardPicture }}">\n\n        </label>\n      </div>\n\n      <div class="card-item person" dr-container=".card-content" dr-model="model.store.position.person" dr-grid="10">\n\n        <p meditor ng-model="model.store.card.name" class="fn"></p>\n        <p meditor ng-model="model.store.card.position" class="title"></p>\n\n      </div>\n\n      <div class="card-item details" dr-container=".card-content" dr-model="model.store.position.details" dr-grid="10">\n\n        <p meditor ng-model="model.store.card.organization" class="org"></p>\n        <p meditor ng-model="model.store.card.location" class="location"></p>\n        <p meditor ng-model="model.store.card.phone" class="tel"></p>\n\n      </div>\n\n      <div class="card-item email" dr-container=".card-content" dr-model="model.store.position.email" dr-grid="10">\n\n        <p meditor ng-model="model.store.card.email"></p>\n\n      </div>\n\n      <div class="card-item url" dr-container=".card-content" dr-model="model.store.position.url" dr-grid="10">\n\n        <p meditor ng-model="model.store.card.url"></p>\n\n      </div>\n\n    </div>\n\n  </div>\n\n</div>\n\n<ul class="download-buttons">\n  <li class="order-btn order-btn-psprint">\n\n    <button class="button secondary js-order-btn-psprint" ng-click="DownloadPicture()">\n      <i class="fa fa-shopping-cart"></i>\n      60% Off Business Cards\n\n      <small>\n        Get your business cards printed and delivered at the best quality and price!\n      </small>\n\n      <span class="button-promo">\n        Ends {{ model.promoExpire | date:\'MM.dd.yy\' }}\n      </span>\n    </button>\n\n    <p class="partner-text">\n      Powered by\n      <a href="http://www.shareasale.com/r.cfm?b=283670&u=1215865&m=22819&urllink=&afftrack=" target="_blank">\n        PsPrint\n      </a>\n    </p>\n\n  </li>\n  <li>\n\n    <a data-toggle="drop-downloads" class="button muted button-download js-download-dropdown-btn float-right">\n      <i class="fa fa-arrow-circle-o-down"></i>\n      <span>Download as...</span>\n    </a>\n\n    <div id="drop-downloads" class="dropdown-pane bottom dropdown-download-files" data-dropdown data-close-on-click="true">\n      <button type="button" ng-click="DownloadPdf()" class="js-newsletter-subscribe button-download-file">\n        <i class="fa fa-file-text"></i>\n        Download as PDF\n      </button>\n\n      <button type="button" ng-click="DownloadPicture()" class="js-newsletter-subscribe button-download-file">\n        <i class="fa fa-picture-o"></i>\n        Download as JPEG\n      </button>\n    </div>\n\n  </li>\n</ul>\n\n')}]);
//# sourceMappingURL=app.js.map